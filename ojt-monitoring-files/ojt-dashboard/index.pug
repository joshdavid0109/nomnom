meta(charset='UTF-8')
meta(name='viewport' content='width=device-width, initial-scale=1.0')
title Admin
link(rel='stylesheet' type='text/css' href='/ojt-dashboard/styles.css')
link(rel='stylesheet' href='https://unicons.iconscout.com/release/v4.0.0/css/line.css')
link(rel='stylesheet' href='https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200')
header
  nav.navbar
    .nav-logo SAINT LOUIS UNIVERSITY
    .nav-name  
      p #{adviser.adviserName.split(' ').reverse().join(' ').replace(',', '') }
    form(action='/ojt-dashboard/uploadpp' method='POST' target='_blank')
      .nav-item
          img#profile-image(src='../ojt-images/jannsen.png' alt='Profile')
          input#fileInput(type='file', style='display: none;', accept='image/*', name="prof_image")
main.container
  aside.left-nav
    ol
      li
        a(href='/ojt-dashboard') DASHBOARD
      li
        a(href='/ojt-pending') PENDING
      li
        a(href='#') ABOUT US
      li
      form(action='/logout' method="GET")
        input(id="logoutbutton" type="submit" value="LOG OUT")
    img(src='../' alt='')
  section
    .main-dashboard
      .main-dashboard-content
        .main-dashboard-title  DASHBOARD
        .intern-details
          .bg-image
            .blue-shade
              img(src='../ojt-images/maryheights.jpg' alt='maryheights')
          .details
            .adviser-name 
              if adviser
                p #{adviser.adviserName.split(' ').reverse().join(' ').replace(',', '')}
            .yellow-horizontal.bar
            .db-time-and-date
              .dashboard-slu-logo
                img(src='../ojt-images/slu-logo.png' alt='slu logo')
              .dashboard-time
                .time-text TIME
                #current-time 10:22:31 GMT+7
              .dashboard-date
                .date-text DATE
                #current-date MONDAY, 20 NOVEMBER 2023
          .intern-count-box
            .pending-students
              .count 
                if (pendingcount)
                  text #{pendingcount}
              .text TOTAL PENDING STUDENTS
            .total-interns
              .count
                 if(total)
                  text #{total}
              .text TOTAL INTERNS
            .finished-interns
              .count
                 if (finished)
                   text #{finished}
              .text 
                 if (finished)
                   text #{"TOTAL FINISHED INTERNS"}
                  
    .filtering
      .filtering-fields
        .input-box
          input(type='text' placeholder='Search here...')
          i#search-icon.uil.uil-search
    .intern-list-container
      .table-label-filter
        .title INTERNS
       
        .filter
          label.view-by(for='view-by')  FILTER 
          select#intern-filter
            option(value='asdsadasdasdas') Name
            option(value='')
            option(value='')
            option(value='')
      .intern-table
        table.intern-table-holder
          tbody
            tr.table-header
              th
                | NAME
              th
                | CLASS CODE
              th
                | COMPANY
              th
                | ADDRESS
              th
                | TOTAL HOURS
              th
                | STATUS
            each intern in interns
              tr.table-data(data-intern-id=intern.studentname class='intern-row')
                td= intern.studentname
                td= intern.classcode
                td= intern.companyname
                td= intern.companyaddress
                td.tothours= intern.totalhours
                td= intern.status
  .popup-container#popupContainer
        span.close-btn(onclick="closePopup()") Ã—
        .requirements-box
          .header-container
            h2#studentName #{studentName} 
            .report-links
              ol 
                li 
                a(href='/ojt-dashboard') Daily Report
                li 
                a(href='/ojt-dashboard') Weekly Report
                li 
                a(href='/ojt-dashboard') DASHBOARD
          .popup-scrollable
                table
                  thead
                    tr
                      th Date
                      th Time in
                      th Time out
                      th Supervisor
                      th Description 
                      th Hours
                      th Supporting Documents 
                      th Remarks 
                      th Status
                  tbody
         

      
      
  section.third-column
    .announcement-column
      .announcement-title
        | ANNOUNCEMENTS
      .announcement-container
        .scroll-container
          each announcement in announcements
            .announcement-box
              .announcement-box-title
                text #{announcement.subject}
              .announcement-box-date
                text #{announcement.date}
              .announcement-box-recipient TO: 
                  text #{announcement.studentName}
              .announcement-box-content
                text #{announcement.message}
              .gray-horizontal-divider

            
        button.create-post-button(type='button')
          a(href='#announcement-pop-up') CREATE POST
form(action='/ojt-dashboard/postannouncement' id="recipient-form" method='POST' target='_blank')
  #announcement-pop-up.modal(action='submit')
    .content
      a.close(href='#main') &Cross;
      .form(action="postannouncement" method="POST" target="_blank" )
        .content_info_holder
          .header ANNOUNCEMENT
          .filter
              .rec-option-text#recipients
                  a(href='#announcement-pop-up1')
                    span.material-symbols-outlined#message-recipient(style="vertical-align= middle")
                      | TO ALL
                      | add
          .horizontal-gray-ruler
          .pop-up-subject
            .title SUBJECT
            // populate with subject txt
            textarea#description-text-area.content-holder-subject(name='subject-text' cols='30' rows='3')
            .horizontal-gray-ruler
            .title DESCRIPTION
            textarea#description-text-area.content-holder-description(name='description-text' cols='30' rows='10')
            input(type="hidden" name="sender", value=adviser.adviserID)
            input(type="hidden" name="recipient", value="0")
            input.create-post-button(id="submitbutton" type="submit" value="SUBMIT") 
  | &gt;
  #announcement-pop-up1.modal(action='submit')
    .content
      a.close(href='#main') &Cross;
      .content_info_holder
        .header
          div
            a(href='#announcement-pop-up')
              span.material-symbols-outlined#back-button
                | keyboard_return
          .text SPECIFIC INTERNS
        div
        .horizontal-gray-ruler
        .input-box
          input(type='text' placeholder='Search here...')
          i#search-icon.uil.uil-search

        .interns-placeholder
          each intern in interns
            .intern-row-checkbox
              .flex-container
                .img-holder
                  img.profile-image(src='../ojt-images/jannsen.png' alt='Profile')
                .intern-details
                  .intern-name 
                    text #{intern.studentname}
                  div.companyname
                    text #{intern.companyname}
                  div.companyaddress 
                    text #{intern.companyaddress} 
              input(type='checkbox' name="recipient" value=intern.studentname)            
           
              
script.
  // Displays the current time with respect to UTC+8 time zone
  function updateCurrentTime() {
      var now = new Date();
      var hours = now.getUTCHours() + 8;
      var minutes = now.getUTCMinutes();
      var seconds = now.getUTCSeconds();
      // Adjust hours to wrap around 24
      hours = hours % 24;
      // Format minutes and seconds to always be two digits
      minutes = minutes < 10 ? '0' + minutes : minutes;
      seconds = seconds < 10 ? '0' + seconds : seconds;
      var currentTimeString = hours + ':' + minutes + ':' + seconds + ' UTC+8';
      document.getElementById('current-time').textContent = currentTimeString;
  }

    setInterval(updateCurrentTime, 1000);
    updateCurrentTime();
    // Displays current date from device
  function updateCurrentDate() {
      var options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      var currentDate = new Date().toLocaleDateString('en-US', options);
      document.getElementById('current-date').textContent = currentDate;
  }
      updateCurrentDate();

  document.getElementById('profile-image').addEventListener('click', function() {
    document.getElementById('fileInput').click();
  })

  document.getElementById('fileInput').addEventListener('change', function() {
    const file = this.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('profile-image').src = e.target.result;
        }
        reader.readAsDataURL(file);
    }
  })

  
 

  document.getElementById("back-button").addEventListener('click', () => {
    console.log("back button")
    const form = document.getElementById('recipients');

      const checkedCheckboxes = document.querySelectorAll('input[type="checkbox"]:checked');
      const checkedValues = Array.from(checkedCheckboxes).map((checkbox) => checkbox.value);

      if (checkedValues.length > 0) {
        document.getElementById("message-recipient").remove();
          checkedCheckboxes.forEach(checkbox => {
          // Create a wrapper div for each input/button pair
              const wrapperDiv = document.createElement('div');
              wrapperDiv.classList.add('input-wrapper');

              // Create the hidden input element to store the checkbox value
              const hiddenInput = document.createElement('input');
              hiddenInput.type = 'hidden';
              hiddenInput.name = 'recipients[]';
              hiddenInput.value = checkbox.value;
              
              // Create a visible text input to display the checkbox value
              const textInput = document.createElement('input');
              textInput.type = 'text';
              textInput.value = checkbox.value;
              textInput.readOnly = true; // Prevent editing the text input
              textInput.classList.add('display-input');
              textInput.style.border = "none";

              // Create the "X" button element to remove the input
              const removeButton = document.createElement('span');
              removeButton.textContent = 'close';
              removeButton.classList.add('material-symbols-outlined');
              removeButton.style.verticalAlign = "middle";
              removeButton.style.cursor = "pointer";
              
              // Append the hidden input, text input, and remove button to the wrapper
              wrapperDiv.appendChild(hiddenInput);
              wrapperDiv.appendChild(textInput);
              wrapperDiv.appendChild(removeButton);
              
              // Append the wrapper div to the form
              form.appendChild(wrapperDiv);

              // Add an event listener to the remove button to handle the click event
              removeButton.addEventListener('click', function() {
                // Remove the wrapper div from the form to remove both the button and the input

              const checkboxValueToUncheck = checkbox.value; // Replace this with the actual value
              const checkboxToUncheck = document.querySelector(`input[type="checkbox"][value="${checkboxValueToUncheck}"]`);

              if (checkboxToUncheck) {
                  checkboxToUncheck.checked = false;
              }
                wrapperDiv.remove();
                console.log ("kjh")

                 if (form.children.length == 1) {

                  const aLink = document.createElement('a');
                  aLink.href = '#announcement-pop-up1';

                  const rec = document.createElement('pan');
                  rec.id = 'message-recipient';
                  rec.classList.add('material-symbols-outlined');
                  rec.style.verticalAlign = 'middle';
                  rec.textContent = 'TO ALL add';

                  aLink.appendChild(rec);

                  form.appendChild(aLink)
                }
              });
        });
      }

  })
   
  // opens the popup container and populates the student details
          function openPopup(studentName) {
              document.getElementById('studentName').innerHTML = studentName;
              document.querySelector('.popup-container').style.display = 'block';
              console.log('open')
          }
  
          // closes the popup container
          function closePopup() {
               document.querySelector('.popup-container').style.display = 'none';
               console.log('close')
         
          }
  
          // adds click event listeners to the first <td> element within each row and calls the openPopup function
         document.addEventListener('DOMContentLoaded', function() {
         var rows = document.querySelectorAll('.table-data');
         rows.forEach(function(row) {
          row.addEventListener('click', function() {
              var internName = row.dataset.internId;
           
              var studentName = row.textContent; // Ensure you get the studentName correctly
              fetch(`/ojt-dashboard/daily-reports/${internName}`)
                  .then(response => response.text())
                  .then(html => {
                      document.getElementById('studentName').innerHTML = internName;
                      document.querySelector('.popup-container').style.display = 'block';
                      document.querySelector('.popup-scrollable table tbody').innerHTML = html;
                  })
                  .catch(error => console.error('Error:', error));
            });
        });
        });
 
  
  


    

